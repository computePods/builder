# This CEKit module describes how to install the computePods MajorDomo 
# tool in an Alpine container. 

# This module:
# - assumes an Alpine (apk) based container,

schema_version: 1

name: cpMajorDomoServer
version: 1.0
description: Installs the computePod MajorDomo coordination service
from: cpLuaLuvNatsWebLit

execute:
  - script: installCPMajorDomo.sh

packages:
  manager: apk
  install:
#    - ruby-dev
#    - openssl-dev
#    - make
#    - gcc
#    - g++
#    - python3
 #   - py3-pip
    - openssl

artifacts:
    # The binary lua modules built in the builder image
  - name: luaLibs
    image: cpLuaLuvNatsWebLitBuild-apk
    path: /root/luaLibs.tar
    target: luaLibs.tar

  - name: cpMajorDomo
    # see: https://github.com/computePods/computePodMajorDomo
    url: https://api.github.com/repos/computePods/computePodMajorDomo/tarball/main
    target: cpMajorDomo.tar.gz

run:
  cmd:
    - sleep
    - infinity

# Tell cpb that we have a multi stage build which requires the
# cpLuaLuvNatsWebLitBuild-apk image
#
artifactImages:
 - cpLuaLuvNatsWebLitBuild-apk
